name: Create iTrac Ticket Manually

on:
    workflow_call: 

jobs:
    create-itrac-ticket:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout code
          uses: actions/checkout@v2

        - name: POST Request iTrac Ticket
          id: create-ticket
          run: |
            curl --request POST \
            --url 'https://itrac.eur.ad.sag/rest/api/2/issue' \
            --user 'sups@softwareag.com:${{secrets.ITRAC_TOKEN}}' \
            --header 'Accept: application/json' \
            --header 'Content-Type: application/json' \
            --data '{
                "fields": {
                    "customfield_21481": null,
                    "customfield_21480": null,
                    "customfield_10230": null,
                    "customfield_10472": null,
                    "fixVersions": [
                        {
                            "self": "https://itrac.eur.ad.sag/rest/api/2/version/246274",
                            "id": "246274",
                            "description": "",
                            "name": "2023Jul",
                            "archived": false,
                            "released": false,
                            "releaseDate": "2023-07-31"
                        }
                    ],
                    "customfield_10231": null,
                    "resolution": null,
                    "customfield_10750": null,
                    "customfield_10751": null,
                    "customfield_15080": null,
                    "lastViewed": "2023-10-16T09:07:12.973+0200",
                    "customfield_12480": null,
                    "customfield_20780": null,
                    "customfield_10580": null,
                    "customfield_12880": null,
                    "customfield_20380": [],
                    "customfield_10220": null,
                    "customfield_12881": null,
                    "priority": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/priority/6",
                        "iconUrl": "https://itrac.eur.ad.sag/images/icons/priority_undefined.gif",
                        "name": "None",
                        "id": "6"
                    },
                    "customfield_10980": "9223372036854775807",
                    "customfield_10221": null,
                    "customfield_10981": "9223372036854775807",
                    "labels": [
                        "QM_Tasks"
                    ],
                    "customfield_10620": null,
                    "customfield_10216": null,
                    "customfield_10217": null,
                    "customfield_10218": null,
                    "aggregatetimeoriginalestimate": null,
                    "timeestimate": null,
                    "versions": [],
                    "customfield_10219": null,
                    "issuelinks": [
                        {
                            "id": "1508753",
                            "self": "https://itrac.eur.ad.sag/rest/api/2/issueLink/1508753",
                            "type": {
                                "id": "10050",
                                "name": "Clone",
                                "inward": "is cloned by",
                                "outward": "is clone of",
                                "self": "https://itrac.eur.ad.sag/rest/api/2/issueLinkType/10050"
                            },
                            "outwardIssue": {
                                "id": "1800074",
                                "key": "AIMT-261",
                                "self": "https://itrac.eur.ad.sag/rest/api/2/issue/1800074",
                                "fields": {
                                    "summary": "Create workflow to automate customer regression Mail report with respective assignees",
                                    "status": {
                                        "self": "https://itrac.eur.ad.sag/rest/api/2/status/10000",
                                        "description": "",
                                        "iconUrl": "https://itrac.eur.ad.sag/images/icons/status_new-sag.gif",
                                        "name": "New",
                                        "id": "10000",
                                        "statusCategory": {
                                            "self": "https://itrac.eur.ad.sag/rest/api/2/statuscategory/2",
                                            "id": 2,
                                            "key": "new",
                                            "colorName": "default",
                                            "name": "To Do"
                                        }
                                    },
                                    "priority": {
                                        "self": "https://itrac.eur.ad.sag/rest/api/2/priority/5",
                                        "iconUrl": "https://itrac.eur.ad.sag/images/icons/priorities/trivial.svg",
                                        "name": "4-Low",
                                        "id": "5"
                                    },
                                    "issuetype": {
                                        "self": "https://itrac.eur.ad.sag/rest/api/2/issuetype/10500",
                                        "id": "10500",
                                        "description": "",
                                        "iconUrl": "https://itrac.eur.ad.sag/secure/viewavatar?size=xsmall&avatarId=57901&avatarType=issuetype",
                                        "name": "Ticket",
                                        "subtask": false,
                                        "avatarId": 57901
                                    }
                                }
                            }
                        }
                    ],
                    "assignee": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/user?username=pmur",
                        "name": "pmur",
                        "key": "JIRAUSER77002",
                        "emailAddress": "Preethi.Krishna@softwareag.com",
                        "avatarUrls": {
                            "48x48": "https://itrac.eur.ad.sag/secure/useravatar?avatarId=11422",
                            "24x24": "https://itrac.eur.ad.sag/secure/useravatar?size=small&avatarId=11422",
                            "16x16": "https://itrac.eur.ad.sag/secure/useravatar?size=xsmall&avatarId=11422",
                            "32x32": "https://itrac.eur.ad.sag/secure/useravatar?size=medium&avatarId=11422"
                        },
                        "displayName": "Krishna M, Preethi",
                        "active": true,
                        "timeZone": "Asia/Kolkata"
                    },
                    "status": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/status/10000",
                        "description": "",
                        "iconUrl": "https://itrac.eur.ad.sag/images/icons/status_new-sag.gif",
                        "name": "New",
                        "id": "10000",
                        "statusCategory": {
                            "self": "https://itrac.eur.ad.sag/rest/api/2/statuscategory/2",
                            "id": 2,
                            "key": "new",
                            "colorName": "default",
                            "name": "To Do"
                        }
                    },
                    "components": [
                        {
                            "self": "https://itrac.eur.ad.sag/rest/api/2/component/120112",
                            "id": "120112",
                            "name": "CI/CD",
                            "description": "topics related to Promotion , CI/CD process and tooling"
                        }
                    ],
                    "customfield_21187": null,
                    "customfield_21186": null,
                    "customfield_17089": null,
                    "customfield_21185": null,
                    "customfield_17088": null,
                    "customfield_21184": null,
                    "customfield_17880": 12,
                    "customfield_21183": [],
                    "customfield_10570": null,
                    "customfield_21182": null,
                    "customfield_10296": null,
                    "customfield_16796": null,
                    "customfield_21181": null,
                    "customfield_10298": null,
                    "customfield_10213": null,
                    "customfield_10730": null,
                    "archiveddate": null,
                    "aggregatetimeestimate": null,
                    "customfield_20880": null,
                    "creator": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/user?username=nasu",
                        "name": "nasu",
                        "key": "nasu",
                        "emailAddress": "Nanthini.Sukumaran@softwareag.com",
                        "avatarUrls": {
                            "48x48": "https://itrac.eur.ad.sag/secure/useravatar?ownerId=nasu&avatarId=55522",
                            "24x24": "https://itrac.eur.ad.sag/secure/useravatar?size=small&ownerId=nasu&avatarId=55522",
                            "16x16": "https://itrac.eur.ad.sag/secure/useravatar?size=xsmall&ownerId=nasu&avatarId=55522",
                            "32x32": "https://itrac.eur.ad.sag/secure/useravatar?size=medium&ownerId=nasu&avatarId=55522"
                        },
                        "displayName": "Sukumaran, Nanthini",
                        "active": true,
                        "timeZone": "Asia/Kolkata"
                    },
                    "subtasks": [],
                    "customfield_10281": null,
                    "reporter": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/user?username=nasu",
                        "name": "nasu",
                        "key": "nasu",
                        "emailAddress": "Nanthini.Sukumaran@softwareag.com",
                        "avatarUrls": {
                            "48x48": "https://itrac.eur.ad.sag/secure/useravatar?ownerId=nasu&avatarId=55522",
                            "24x24": "https://itrac.eur.ad.sag/secure/useravatar?size=small&ownerId=nasu&avatarId=55522",
                            "16x16": "https://itrac.eur.ad.sag/secure/useravatar?size=xsmall&ownerId=nasu&avatarId=55522",
                            "32x32": "https://itrac.eur.ad.sag/secure/useravatar?size=medium&ownerId=nasu&avatarId=55522"
                        },
                        "displayName": "Sukumaran, Nanthini",
                        "active": true,
                        "timeZone": "Asia/Kolkata"
                    },
                    "customfield_12981": null,
                    "customfield_12980": null,
                    "aggregateprogress": {
                        "progress": 0,
                        "total": 0
                    },
                    "customfield_10320": null,
                    "customfield_10314": null,
                    "customfield_10318": null,
                    "progress": {
                        "progress": 0,
                        "total": 0
                    },
                    "votes": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/issue/AIMT-306/votes",
                        "votes": 0,
                        "hasVoted": false
                    },
                    "worklog": {
                        "startAt": 0,
                        "maxResults": 20,
                        "total": 0,
                        "worklogs": []
                    },
                    "archivedby": null,
                    "customfield_19882": null,
                    "issuetype": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/issuetype/10500",
                        "id": "10500",
                        "description": "",
                        "iconUrl": "https://itrac.eur.ad.sag/secure/viewavatar?size=xsmall&avatarId=57901&avatarType=issuetype",
                        "name": "Ticket",
                        "subtask": false,
                        "avatarId": 57901
                    },
                    "customfield_19883": null,
                    "customfield_17580": null,
                    "customfield_19884": null,
                    "customfield_10390": null,
                    "customfield_19880": null,
                    "customfield_17980": 12,
                    "timespent": null,
                    "customfield_11480": [
                        "com.atlassian.greenhopper.service.sprint.Sprint@27949936[id=5596,rapidViewId=1596,state=ACTIVE,name=QM_Tasks_Sprint2,startDate=2023-10-03T06:53:00.000+02:00,endDate=2023-10-13T06:53:00.000+02:00,completeDate=<null>,activatedDate=2023-10-11T06:57:34.858+02:00,sequence=5596,goal=,autoStartStop=false,synced=false]"
                    ],
                    "customfield_19881": null,
                    "project": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/project/32120",
                        "id": "32120",
                        "key": "AIMT",
                        "name": "AIM Tickets",
                        "projectTypeKey": "software",
                        "avatarUrls": {
                            "48x48": "https://itrac.eur.ad.sag/secure/projectavatar?avatarId=55303",
                            "24x24": "https://itrac.eur.ad.sag/secure/projectavatar?size=small&avatarId=55303",
                            "16x16": "https://itrac.eur.ad.sag/secure/projectavatar?size=xsmall&avatarId=55303",
                            "32x32": "https://itrac.eur.ad.sag/secure/projectavatar?size=medium&avatarId=55303"
                        },
                        "projectCategory": {
                            "self": "https://itrac.eur.ad.sag/rest/api/2/projectCategory/13670",
                            "id": "13670",
                            "description": "",
                            "name": "Integration & API"
                        }
                    },
                    "customfield_10671": null,
                    "customfield_10550": null,
                    "customfield_10430": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/customFieldOption/10381",
                        "value": "Internal",
                        "id": "10381",
                        "disabled": false
                    },
                    "aggregatetimespent": null,
                    "customfield_10673": null,
                    "customfield_10431": null,
                    "customfield_10674": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/customFieldOption/10603",
                        "value": "Yes",
                        "id": "10603",
                        "disabled": false
                    },
                    "resolutiondate": null,
                    "workratio": -1,
                    "customfield_19480": null,
                    "customfield_19481": null,
                    "watches": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/issue/AIMT-306/watchers",
                        "watchCount": 1,
                        "isWatching": false
                    },
                    "customfield_14180": null,
                    "customfield_14184": "0|i7l6b4:",
                    "created": "2023-10-04T07:13:06.477+0200",
                    "customfield_14185": "2|i2jssn:",
                    "customfield_10420": {
                        "self": "https://itrac.eur.ad.sag/rest/api/2/customFieldOption/10370",
                        "value": "Bug",
                        "id": "10370",
                        "disabled": false
                    },
                    "customfield_10301": null,
                    "updated": "2023-10-13T14:12:15.873+0200",
                    "customfield_17681": null,
                    "customfield_17680": null,
                    "timeoriginalestimate": null,
                    "description": "Create workflow to automate customer regression retrospective which has be done once in  every month",
                    "customfield_10770": null,
                    "customfield_10254": null,
                    "customfield_10650": null,
                    "customfield_10530": null,
                    "customfield_10531": null,
                    "customfield_10014": [
                        "pmur(JIRAUSER77002)",
                        "nasu(nasu)"
                    ],
                    "timetracking": {},
                    "customfield_10006": null,
                    "customfield_10007": null,
                    "attachment": [],
                    "summary": "Ticket from GitHub Workflow",
                    "customfield_14280": null,
                    "customfield_10081": null,
                    "customfield_10083": null,
                    "customfield_10084": null,
                    "customfield_10240": null,
                    "customfield_10000": null,
                    "customfield_10001": null,
                    "customfield_10243": null,
                    "customfield_10760": null,
                    "customfield_10002": null,
                    "customfield_10244": null,
                    "customfield_10640": null,
                    "customfield_10003": null,
                    "customfield_10520": null,
                    "environment": null,
                    "duedate": null,
                    "comment": {
                        "comments": [],
                        "maxResults": 0,
                        "total": 0,
                        "startAt": 0
                    },
                    "customfield_18080": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@fd97799[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@32a0153[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@215bb8ff[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7228051e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2c392419[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1a0666b6[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6666b949[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5454506e[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@31a8bf11[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@18b25c44[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4bcd02ea[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@3d6cecdd[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}"
                }
            }'

          env:
            ITRAC_TOKEN:  MTkyNzgzMDI2MTgxOiiSNv4rS88DmyDYX/70gi45AZvC